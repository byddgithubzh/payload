name: get_bootimg_from_payload.bin

on:
  watch:
    types: [started]
    
env:
  ROM_URL:  https://kqekllm5ftnb6q9sl2cljlc4b2qc266btmat08rblcp4atg9k0cvu8t3.qc.dolfincdnx.net:10443/xdispatch759f5c113da3ad31/bigota.d.miui.com/V14.0.7.0.TLTCNXM/mayfly_images_V14.0.7.0.TLTCNXM_20230210.0000.00_13.0_cn_9b04c85dc0.tgz?bsreqid=1989e5f6544b66e8f7b1dcdd3f0dfcfb&bsxdisp=se

  TZ: Asia/Shanghai

jobs:
  make:
    runs-on: ubuntu-latest

    steps:

    - name: Download the ROM
      run: |
       cd ~
       wget -O rom.tgz $ROM_URL
       wget -o 7z.zip https://github.com/byddgithubzh/alto_payload/raw/main/7z.zip
       unzip 7z.zip
       ls
       7z
   
    - name: unzip the ROM
      run: |
       cd ~
       tar -zxvf rom.tgz 
       mv ~/dagu_images_V13.1.4.0.SLZCNXM_20220804.0000.00_12.0_cn/images/super.img ~/super.img
       ls -l
       7z e super.img
       7z e system_a.img
       cd ~/system
       cd media
       zip -vr media.zip 
       tree
   
    - name : Upload images1
        cd ~
      uses: actions/upload-artifact@master
      if: always()
      with:
        name: 12S_PRO_logo_Payload-images
        path: ~/dagu_images_V13.1.4.0.SLZCNXM_20220804.0000.00_12.0_cn/images/imagefv.*
        
    - name : Upload images2
        cd ~
      uses: actions/upload-artifact@master
      if: always()
      with:
        name: 12S_PRO_splash_Payload-images
        path: ~/dagu_images_V13.1.4.0.SLZCNXM_20220804.0000.00_12.0_cn/images/logo.*
        
    - name : Upload images3
        cd ~
      uses: actions/upload-artifact@master
      if: always()
      with:
        name: 12S_PRO_splash_Payload-images
        path: ~/system/media/*.*
